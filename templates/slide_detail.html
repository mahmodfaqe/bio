{% extends "base.html" %}

{% block content %}
<div class="slide-detail-container">
  <!-- Slide Header -->
  <div class="slide-header">
    <div class="breadcrumb">
      <a href="{{ url_for('chapters', lang=lang) }}">{{ t['nav_chapters'] }}</a>
      <span class="separator">›</span>
      <a href="{{ url_for('chapter', lang=lang, chapter_id=chapter.id) }}">{{ chapter.get_title(lang) }}</a>
      <span class="separator">›</span>
      <span class="current">{{ slide.get_title(lang) }}</span>
    </div>

    <h1 class="slide-title">{{ slide.get_title(lang) }}</h1>

    <div class="slide-meta">
      <div class="meta-item">
        <i class="fas fa-layer-group"></i>
        <span>{{ t['chapter'] }} {{ chapter.order }}</span>
      </div>
      <div class="meta-item">
        <i class="fas fa-eye"></i>
        <span>{{ slide.view_count }} {{ t.get('views', 'views') }}</span>
      </div>
      <div class="meta-item">
        <i class="fas fa-clock"></i>
        <span>{{ slide.updated_at.strftime('%Y-%m-%d') if slide.updated_at else 'N/A' }}</span>
      </div>
    </div>
  </div>

  <!-- Main Slide Content -->
  <div class="slide-content-wrapper">
    <div class="slide-main">
      <!-- Image Section -->
      {% if slide.get_image_url() %}
      <div class="slide-image-container">
        <div class="image-wrapper">
          <img src="{{ slide.get_image_url() }}"
               alt="{{ slide.get_title(lang) }}"
               class="slide-image"
               loading="lazy">
          <div class="image-overlay">
            <button class="zoom-btn" onclick="toggleImageZoom()">
              <i class="fas fa-search-plus"></i>
            </button>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Content Section -->
      {% if slide.get_content(lang) %}
      <div class="content-section">
        <h2 class="content-title">
          <i class="fas fa-file-alt"></i>
          {{ t.get('description', 'Description') }}
        </h2>
        <div class="content-text">
          {{ slide.get_content(lang) | safe }}
        </div>
      </div>
      {% endif %}

      <!-- Study Information Grid -->
      <div class="study-info-grid">
        {% if slide.components %}
        <div class="info-card">
          <h3>
            <i class="fas fa-puzzle-piece"></i>
            {{ t['components'] }}
          </h3>
          <div class="info-content">
            {{ slide.components | safe }}
          </div>
        </div>
        {% endif %}

        {% if slide.location %}
        <div class="info-card">
          <h3>
            <i class="fas fa-map-marker-alt"></i>
            {{ t['location'] }}
          </h3>
          <div class="info-content">
            {{ slide.location | safe }}
          </div>
        </div>
        {% endif %}

        {% if slide.functions %}
        <div class="info-card">
          <h3>
            <i class="fas fa-cogs"></i>
            {{ t['functions'] }}
          </h3>
          <div class="info-content">
            {{ slide.functions | safe }}
          </div>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Sidebar -->
    <div class="slide-sidebar">
      <!-- Chapter Info -->
      <div class="sidebar-card chapter-info">
        <h3>
          <i class="{{ chapter.icon }}"></i>
          {{ chapter.get_title(lang) }}
        </h3>
        <p>{{ chapter.get_description(lang) }}</p>
        <a href="{{ url_for('chapter', lang=lang, chapter_id=chapter.id) }}" class="btn btn-outline">
          <i class="fas fa-arrow-left"></i>
          {{ t.get('back_to_chapter', 'Back to Chapter') }}
        </a>
      </div>

      <!-- Other Slides -->
      {% if other_slides %}
      <div class="sidebar-card other-slides">
        <h3>
          <i class="fas fa-list"></i>
          {{ t.get('other_slides', 'Other Slides') }}
        </h3>
        <div class="slides-list">
          {% for other_slide in other_slides %}
          <a href="{{ url_for('slide_detail', lang=lang, slide_id=other_slide.id) }}"
             class="slide-link {% if other_slide.id == slide.id %}active{% endif %}">
            {% if other_slide.get_thumbnail_url() %}
            <div class="slide-thumb">
              <img src="{{ other_slide.get_thumbnail_url() }}"
                   alt="{{ other_slide.get_title(lang) }}">
            </div>
            {% else %}
            <div class="slide-thumb no-image">
              <i class="fas fa-image"></i>
            </div>
            {% endif %}
            <div class="slide-info">
              <span class="slide-name">{{ other_slide.get_title(lang) }}</span>
              <small class="slide-views">{{ other_slide.view_count }} {{ t.get('views', 'views') }}</small>
            </div>
          </a>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- Quick Actions -->
      <div class="sidebar-card quick-actions">
        <h3>
          <i class="fas fa-bolt"></i>
          {{ t['quick_actions'] }}
        </h3>
        <div class="action-buttons">
          <button class="btn btn-icon" onclick="printSlide()" title="{{ t.get('print', 'Print') }}">
            <i class="fas fa-print"></i>
          </button>
          <button class="btn btn-icon" onclick="shareSlide()" title="{{ t.get('share', 'Share') }}">
            <i class="fas fa-share-alt"></i>
          </button>
          <button class="btn btn-icon" onclick="bookmarkSlide()" title="{{ t.get('bookmark', 'Bookmark') }}">
            <i class="fas fa-bookmark"></i>
          </button>
          <button class="btn btn-icon" onclick="toggleFullscreen()" title="{{ t.get('fullscreen', 'Fullscreen') }}">
            <i class="fas fa-expand"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Image Zoom Modal -->
<div id="imageZoomModal" class="zoom-modal">
  <div class="zoom-modal-content">
    <span class="zoom-close" onclick="closeImageZoom()">&times;</span>
    <img id="zoomedImage" src="" alt="">
  </div>
</div>

<style>
/* Slide Detail Specific Styles */
.slide-detail-container {
  max-width: 1400px;
  margin: 2rem auto;
  padding: 0 1rem;
}

.slide-header {
  margin-bottom: 2rem;
  background: white;
  padding: 2rem;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  border: 1px solid #e2e8f0;
}

.breadcrumb {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 1rem;
  font-size: 0.9rem;
  color: var(--medium-gray);
}

.breadcrumb a {
  color: var(--primary-blue);
  text-decoration: none;
  transition: color 0.3s ease;
}

.breadcrumb a:hover {
  color: var(--secondary-teal);
}

.separator {
  color: var(--medium-gray);
}

.current {
  font-weight: 600;
  color: var(--dark-text);
}

.slide-title {
  font-size: 2.5rem;
  font-weight: 800;
  color: var(--dark-text);
  margin-bottom: 1rem;
  line-height: 1.2;
  background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.slide-meta {
  display: flex;
  gap: 2rem;
  flex-wrap: wrap;
}

.meta-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--medium-gray);
  font-size: 0.9rem;
}

.meta-item i {
  color: var(--warm-gold);
}

.slide-content-wrapper {
  display: grid;
  grid-template-columns: 1fr 350px;
  gap: 2rem;
  align-items: start;
}

.slide-main {
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

/* Image Styles */
.slide-image-container {
  background: white;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
  border: 1px solid #e2e8f0;
  position: relative;
}

.image-wrapper {
  position: relative;
  overflow: hidden;
}

.slide-image {
  width: 100%;
  height: auto;
  max-height: 600px;
  object-fit: contain;
  display: block;
  background: #f8fafc;
  transition: transform 0.3s ease;
}

.image-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0);
  display: flex;
  align-items: flex-start;
  justify-content: flex-end;
  padding: 1rem;
  opacity: 0;
  transition: all 0.3s ease;
}

.image-wrapper:hover .image-overlay {
  opacity: 1;
  background: rgba(0, 0, 0, 0.1);
}

.zoom-btn {
  background: white;
  border: none;
  padding: 0.75rem;
  border-radius: 8px;
  cursor: pointer;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  color: var(--primary-blue);
  transition: all 0.3s ease;
}

.zoom-btn:hover {
  transform: scale(1.1);
  color: var(--secondary-teal);
}

/* Content Section */
.content-section {
  background: white;
  padding: 2rem;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  border: 1px solid #e2e8f0;
}

.content-title {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--dark-text);
  margin-bottom: 1.5rem;
  padding-bottom: 0.75rem;
  border-bottom: 2px solid #f1f5f9;
}

.content-title i {
  color: var(--warm-gold);
}

.content-text {
  line-height: 1.8;
  color: var(--dark-text);
  font-size: 1.1rem;
}

.content-text p {
  margin-bottom: 1rem;
}

.content-text ul, .content-text ol {
  margin: 1rem 0;
  padding-left: 2rem;
}

.content-text li {
  margin-bottom: 0.5rem;
}

/* Study Info Grid */
.study-info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
}

.info-card {
  background: white;
  padding: 1.5rem;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.06);
  border: 1px solid #e2e8f0;
  transition: all 0.3s ease;
}

.info-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.info-card h3 {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 1.2rem;
  font-weight: 700;
  color: var(--dark-text);
  margin-bottom: 1rem;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid #f1f5f9;
}

.info-card h3 i {
  color: var(--accent-emerald);
}

.info-content {
  color: var(--medium-gray);
  line-height: 1.7;
}

/* Sidebar */
.slide-sidebar {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.sidebar-card {
  background: white;
  padding: 1.5rem;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.06);
  border: 1px solid #e2e8f0;
}

.sidebar-card h3 {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--dark-text);
  margin-bottom: 1rem;
}

.sidebar-card h3 i {
  color: var(--warm-gold);
}

.chapter-info p {
  color: var(--medium-gray);
  line-height: 1.6;
  margin-bottom: 1.5rem;
  font-size: 0.9rem;
}

.btn-outline {
  background: transparent;
  color: var(--primary-blue);
  border: 2px solid var(--primary-blue);
  padding: 0.75rem 1.5rem;
  border-radius: 8px;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: 600;
  transition: all 0.3s ease;
  font-size: 0.9rem;
}

.btn-outline:hover {
  background: var(--primary-blue);
  color: white;
  transform: translateY(-1px);
}

/* Other Slides */
.slides-list {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.slide-link {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem;
  border-radius: 8px;
  text-decoration: none;
  transition: all 0.3s ease;
  border: 1px solid transparent;
}

.slide-link:hover {
  background: #f8fafc;
  border-color: #e2e8f0;
}

.slide-link.active {
  background: linear-gradient(135deg, rgba(30, 64, 175, 0.1), rgba(8, 145, 178, 0.1));
  border-color: var(--primary-blue);
}

.slide-thumb {
  width: 50px;
  height: 40px;
  border-radius: 6px;
  overflow: hidden;
  background: #f1f5f9;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.slide-thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.slide-thumb.no-image {
  color: var(--medium-gray);
}

.slide-info {
  flex: 1;
  min-width: 0;
}

.slide-name {
  display: block;
  font-weight: 600;
  color: var(--dark-text);
  font-size: 0.9rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.slide-views {
  color: var(--medium-gray);
  font-size: 0.8rem;
}

/* Quick Actions */
.action-buttons {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.75rem;
}

.btn-icon {
  background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal));
  color: white;
  border: none;
  padding: 1rem;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.1rem;
}

.btn-icon:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(30, 64, 175, 0.3);
}

/* Image Zoom Modal */
.zoom-modal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.9);
  backdrop-filter: blur(5px);
}

.zoom-modal-content {
  position: relative;
  margin: auto;
  padding: 0;
  width: 90%;
  max-width: none;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.zoom-modal-content img {
  max-width: 95%;
  max-height: 95%;
  object-fit: contain;
  border-radius: 8px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
}

.zoom-close {
  position: absolute;
  top: 2rem;
  right: 2rem;
  color: white;
  font-size: 3rem;
  font-weight: bold;
  cursor: pointer;
  z-index: 10000;
  width: 50px;
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.5);
  border-radius: 50%;
  transition: all 0.3s ease;
}

.zoom-close:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: scale(1.1);
}

/* Responsive Design */
@media (max-width: 1024px) {
  .slide-content-wrapper {
    grid-template-columns: 1fr;
  }

  .slide-sidebar {
    order: -1;
  }

  .sidebar-card {
    margin-bottom: 0;
  }
}

@media (max-width: 768px) {
  .slide-detail-container {
    padding: 0 0.5rem;
  }

  .slide-header {
    padding: 1.5rem;
  }

  .slide-title {
    font-size: 2rem;
  }

  .slide-meta {
    gap: 1rem;
  }

  .study-info-grid {
    grid-template-columns: 1fr;
  }

  .content-section,
  .info-card,
  .sidebar-card {
    padding: 1.25rem;
  }

  .breadcrumb {
    flex-wrap: wrap;
  }

  .action-buttons {
    grid-template-columns: repeat(4, 1fr);
  }
}

@media (max-width: 480px) {
  .slide-title {
    font-size: 1.75rem;
  }

  .content-title {
    font-size: 1.3rem;
  }

  .zoom-close {
    top: 1rem;
    right: 1rem;
    font-size: 2rem;
    width: 40px;
    height: 40px;
  }
}

/* RTL Support */
[dir="rtl"] .breadcrumb {
  flex-direction: row-reverse;
}

[dir="rtl"] .slide-content-wrapper {
  grid-template-columns: 350px 1fr;
}

[dir="rtl"] .slide-link {
  flex-direction: row-reverse;
}

[dir="rtl"] .zoom-close {
  left: 2rem;
  right: auto;
}

/* Print Styles */
@media print {
  .slide-sidebar,
  .image-overlay,
  .action-buttons {
    display: none !important;
  }

  .slide-content-wrapper {
    grid-template-columns: 1fr;
  }

  .slide-image {
    max-height: none;
  }
}
</style>

<script>
// Image Zoom Functionality
function toggleImageZoom() {
  const modal = document.getElementById('imageZoomModal');
  const zoomedImg = document.getElementById('zoomedImage');
  const originalImg = document.querySelector('.slide-image');

  if (originalImg) {
    zoomedImg.src = originalImg.src;
    modal.style.display = 'block';
    document.body.style.overflow = 'hidden';
  }
}

function closeImageZoom() {
  const modal = document.getElementById('imageZoomModal');
  modal.style.display = 'none';
  document.body.style.overflow = 'auto';
}

// Close modal when clicking outside the image
document.getElementById('imageZoomModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeImageZoom();
  }
});

// ESC key to close modal
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closeImageZoom();
  }
});

// Quick Actions
function printSlide() {
  window.print();
}

function shareSlide() {
  if (navigator.share) {
    navigator.share({
      title: document.title,
      text: '{{ slide.get_title(lang) }}',
      url: window.location.href
    });
  } else {
    // Fallback to copying URL to clipboard
    navigator.clipboard.writeText(window.location.href).then(() => {
      alert('{{ t.get("link_copied", "Link copied to clipboard!") }}');
    });
  }
}

function bookmarkSlide() {
  // Simple bookmark functionality - could be enhanced with localStorage
  const bookmarks = JSON.parse(localStorage.getItem('biology_bookmarks') || '[]');
  const slideData = {
    id: {{ slide.id }},
    title: '{{ slide.get_title(lang) }}',
    url: window.location.href,
    timestamp: new Date().toISOString()
  };

  const existingIndex = bookmarks.findIndex(b => b.id === slideData.id);
  if (existingIndex > -1) {
    bookmarks.splice(existingIndex, 1);
    alert('{{ t.get("bookmark_removed", "Bookmark removed") }}');
  } else {
    bookmarks.push(slideData);
    alert('{{ t.get("bookmark_added", "Bookmark added") }}');
  }

  localStorage.setItem('biology_bookmarks', JSON.stringify(bookmarks));
}

function toggleFullscreen() {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen();
  } else {
    if (document.exitFullscreen) {
      document.exitFullscreen();
    }
  }
}

// Smooth scroll for anchor links
document.addEventListener('DOMContentLoaded', function() {
  // Add fade-in animation
  const elements = document.querySelectorAll('.slide-header, .slide-main > *, .sidebar-card');
  elements.forEach((el, index) => {
    el.style.opacity = '0';
    el.style.transform = 'translateY(20px)';
    el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';

    setTimeout(() => {
      el.style.opacity = '1';
      el.style.transform = 'translateY(0)';
    }, index * 100);
  });
});
</script>
{% endblock %}