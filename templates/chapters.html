{% extends "base.html" %}
{% block content %}

<style>
  .chapters-overview {
    margin: 2rem 0;
  }

  .overview-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin: 2rem 0 3rem;
  }

  .stat-card {
    background: linear-gradient(135deg, rgba(30, 64, 175, 0.1), rgba(8, 145, 178, 0.05));
    border-radius: 16px;
    padding: 1.5rem;
    text-align: center;
    border: 1px solid rgba(30, 64, 175, 0.1);
  }

  .stat-number {
    font-size: 2.5rem;
    font-weight: bold;
    background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 0.5rem;
  }

  .stat-label {
    color: var(--medium-gray);
    font-weight: 600;
  }

  .chapter-detail-card {
    background: white;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    margin-bottom: 2rem;
    border: 1px solid #e2e8f0;
    transition: all 0.3s ease;
  }

  .chapter-detail-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  }

  .chapter-header {
    display: flex;
    align-items: center;
    padding: 2rem;
    background: linear-gradient(135deg, var(--primary-blue), var(--secondary-teal));
    color: white;
  }

  .chapter-icon-large {
    font-size: 3rem;
    margin-right: 1.5rem;
    opacity: 0.9;
  }

  .chapter-info h3 {
    font-size: 1.8rem;
    margin-bottom: 0.5rem;
  }

  .chapter-meta {
    display: flex;
    gap: 2rem;
    font-size: 0.9rem;
    opacity: 0.9;
  }

  .meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .chapter-body {
    padding: 2rem;
  }

  .chapter-description {
    color: var(--medium-gray);
    line-height: 1.7;
    margin-bottom: 2rem;
    font-size: 1.1rem;
  }

  .chapter-actions {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .progress-bar {
    background: #e2e8f0;
    height: 8px;
    border-radius: 4px;
    overflow: hidden;
    margin: 1rem 0;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(to right, var(--accent-emerald), var(--secondary-teal));
    transition: width 0.3s ease;
  }

  [dir="rtl"] .chapter-icon-large {
    margin-right: 0;
    margin-left: 1.5rem;
  }

  [dir="rtl"] .chapter-header {
    flex-direction: row-reverse;
  }

  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--medium-gray);
  }

  .empty-state i {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: 0.5;
  }
</style>

<!-- Page Header -->
<section class="section-header fade-in">
  <h1 class="section-title">{{ t['chapters_title'] }}</h1>
  <p class="section-subtitle">{{ t['chapters_intro'] }}</p>
</section>

<!-- Overview Statistics -->
{% if chapters %}
<section class="overview-stats fade-in">
  <div class="stat-card">
    <div class="stat-number">{{ chapters|length }}</div>
    <div class="stat-label">{{ t.get('total_chapters', 'Total Chapters') }}</div>
  </div>
  <div class="stat-card">
    <div class="stat-number">
      {% set total_slides = chapters|sum(attribute='slides_count') %}
      {{ total_slides }}
    </div>
    <div class="stat-label">{{ t.get('total_slides', 'Study Materials') }}</div>
  </div>
  <div class="stat-card">
    <div class="stat-number">
      {% set total_views = chapters|sum(attribute='total_views') %}
      {{ total_views }}
    </div>
    <div class="stat-label">{{ t.get('total_views', 'Total Views') }}</div>
  </div>
  <div class="stat-card">
    <div class="stat-number">{{ chapters|selectattr('slides_count', '>', 0)|list|length }}</div>
    <div class="stat-label">{{ t.get('active_chapters', 'Active Chapters') }}</div>
  </div>
</section>
{% endif %}

<!-- Chapters List -->
<section class="chapters-overview fade-in">
  {% if chapters %}
    {% for chapter_data in chapters %}
    {% set chapter = chapter_data.chapter %}
    <div class="chapter-detail-card">
      <div class="chapter-header">
        <i class="chapter-icon-large {{ chapter.icon }}"></i>
        <div class="chapter-info">
          <h3>{{ chapter.order }}. {{ chapter.get_title(lang) }}</h3>
          <div class="chapter-meta">
            <div class="meta-item">
              <i class="fas fa-file-alt"></i>
              <span>{{ chapter_data.slides_count }} {{ t.get('slides', 'slides') }}</span>
            </div>
            <div class="meta-item">
              <i class="fas fa-eye"></i>
              <span>{{ chapter_data.total_views }} {{ t.get('views', 'views') }}</span>
            </div>
            <div class="meta-item">
              <i class="fas fa-clock"></i>
              <span>{{ t.get('updated', 'Updated') }}: {{ chapter.updated_at.strftime('%Y-%m-%d') if chapter.updated_at else 'N/A' }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="chapter-body">
        <p class="chapter-description">{{ chapter.get_description(lang) }}</p>

        <!-- Progress indication based on slides count -->
        {% if chapter_data.slides_count > 0 %}
        <div class="progress-bar">
          <div class="progress-fill" style="width: {{ (chapter_data.slides_count * 10)|min(100) }}%;"></div>
        </div>
        <p style="font-size: 0.9rem; color: var(--medium-gray); margin-bottom: 1.5rem;">
          {{ t.get('completion_status', 'Content available') }}: {{ chapter_data.slides_count }} {{ t.get('materials', 'materials') }}
        </p>
        {% endif %}

        <div class="chapter-actions">
          <a href="{{ url_for('chapter', lang=lang, chapter_id=chapter.id) }}" class="btn btn-primary">
            <i class="fas fa-book-open"></i>
            {{ t['view_chapter'] }}
          </a>
          {% if chapter_data.slides_count > 0 %}
          <a href="{{ url_for('chapter', lang=lang, chapter_id=chapter.id) }}#slides" class="btn btn-secondary">
            <i class="fas fa-list"></i>
            {{ t.get('view_materials', 'View Materials') }} ({{ chapter_data.slides_count }})
          </a>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  {% else %}
    <!-- Empty State -->
    <div class="empty-state">
      <i class="fas fa-book"></i>
      <h3>{{ t.get('no_chapters_title', 'No Chapters Available') }}</h3>
      <p>{{ t.get('no_chapters_message', 'Chapters are being prepared. Please check back later.') }}</p>
    </div>
  {% endif %}
</section>

{% endblock %}